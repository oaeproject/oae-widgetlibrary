<% has_screenshots = @widget.screenshots.size > 0 %>
<div id="widgetdetails_container">
    <div class="wl-inpage-tabs">
      <% if has_screenshots %>
      <div class="wl-inpage-tab selected" id="screenshot_tab">Screenshots</div>
      <div class="wl-inpage-tab" id="reviews_tab">Reviews</div>
      <div class="wl-inpage-tab" id="versions_tab">Uploaded versions</div>
      <% else %>
      <div class="wl-inpage-tab selected" id="reviews_tab">Reviews</div>
      <div class="wl-inpage-tab" id="versions_tab">Uploaded versions</div>
      <% end %>
    </div>
    <div class="wl-inpage-tab-content">
        <div id="widgetdetails_screenshots" class="widgetdetails_tabcontent_content"<% if !has_screenshots %>style="display:none"<% end %>>
            <div id="widgetdetails_newestreviews">
                <% if @widget.ratings.size > 0 %>
                <h1>Latest reviews</h1>
                <%= render :partial => "core/review", :locals => { :display => { :rate_widget => true } }, :collection => @widget.ratings.limit(3) %>
                <hr class="wl-push wl-hidden"/>
                <% end %>
                <% if user_signed_in? && current_user.id != @widget.user.id %>
                  <button class="wl-button wl-header-button" id="write_review">Write a review</a>
                <% end %>
            </div>

            <div id="widgetdetails_screenshot_container">
              <%= render :partial => "screenshots" %>
            </div>
        </div>

        <div id="widgetdetails_reviews" class="widgetdetails_tabcontent_content" <% if has_screenshots %>style="display:none;"<% end %>>
            <% if user_signed_in? && current_user.id != @widget.user.id #Only allow logged in users to review %>
                <%= form_for(@rating, :url => "/widget/#{@widget.url_title}/rate") do |f| %>
                <div id="widgetdetails_reviews_review_widget">
                    <h1>Review this widget</h1>
                    <%= f.text_area :review, :placeholder => "Write a review" %>
                    <%= f.hidden_field :widget_id, :value => @widget.id %>
                    <%= f.hidden_field :user_id, :value => @rating.user_id || current_user.id %>
                    <%= f.hidden_field :stars , :value => @rating.stars.to_i, :class => 'wl-rating-input' %>
                    <%= render :partial => "pagewidgets/rating", :locals => { :display => { :rate_widget => true }, :stars => @rating.stars, :num_ratings => @widget.ratings.size } %>
                    <%= f.submit "Post review", :class => "wl-button wl-header-button" %>
                </div>
                <% end %>
            <% end %>
            <div id="widgetdetails_reviews_all">
                <%= render :partial => "core/review", :locals => { :display => { :rate_widget => true } }, :collection => @widget.ratings %>
            </div>
        </div>

        <div id="widgetdetails_versions" class="widgetdetails_tabcontent_content" style="display:none;">
            <h1>Versions</h1>
            <hr class="wl-split-line" id="widgetdetails_uploadedversions_headerline"/>
            <% @versions.each do |version| %>
                <% if version.languages.size > 0 %>
                  <div class="widgetdetails_uploadedversions_versionlanguage">
                      <p>Languages:</p>
                      <p><%= version.languages.collect{|l| l = l.title}.join(", ") %></p>
                  </div>
                <% end %>
                <div class="widgetdetails_uploadedversions_versiondescription">
                    <%= link_to version.title + " " + version.version_number, "javascript:;", :class => "wl-regular-link wl-bold" %>
                    <span class="widgetdetails_uploadeversions_dateuuploaded"> - released <%= version.released_on.strftime("%B %d, %Y") %></span>
                    <p class="widgetdetails_uploadedversions_mainfeatures">Main features:</p>
                    <p><%= version.features %></p>
                </div>

                <hr class="wl-split-line"/>
            <% end %>

        </div>
    </div>
    <hr class="wl-push wl-hidden">
</div>